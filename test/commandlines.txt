# Generate tests
#
ls -1 *.spdl | ./gen-tests.py 1 >bigtest.sh

# get the fails of the singletons
#
grep -h failed combined1*.txt | awk '{ print $2, $4 }' | sort | uniq >fails1.txt

# get the fails of the combos
# find version
find -name "combined3*.txt" -exec grep -h failed {} \; >tempfile.txt
cat tempfile.txt | awk '{ print $2, $4 }' | sort | uniq >fails3.txt

# find any jewels
#
cat fails1.txt fails2.txt | sort | uniq -u >jewels2.txt

# relocate such a jewel
grep -l "nsl3.*Nisynch_6.*failed" *.txt

# fully automatic relocate
cat jewels2.txt | awk '{ system("grep -l \"" $1 ".*" $2 ".*failed\" combined2*.txt") }' >bad2-combos.txt

cat jewels3.txt | awk '{ system("find -name \"combined3*.txt\" -exec grep -l \\\" $1 \".*\" $2 \".*failed\" {} \\\"\;") }' >bad3-combos.txt
# Instance
find -name "combined3*.txt" -exec grep -l "wmfbrutus.*Secret_3.*failed" {} \;

# remove empty regular files
find -empty -type f | xargs -n 1 rm

# Show an attack on a combo file
cat file1.spdl file2.spdl | ../src/scyther -a - | dot -Tps | ggv -
